{% extends "layout.html" %}

{% block title %}{% if user %}Editar usuario{% else %}Nuevo usuario{% endif %}{% endblock %}

{% block content %}
{# diccionario para formatear nombres de roles #}
{% set role_labels = {
    'public': 'Usuario público',
    'editor': 'Editor',
    'admin': 'Administrador'
} %}

<div class="module-header">
    <h1>{% if user %}Editar usuario{% else %}Nuevo usuario{% endif %}</h1>
    <a href="{{ url_for('users.index') }}" class="secondary-button">← Volver al listado</a>
</div>

{# FORMULARIO #}
<form class="entity-form" method="post" action="{% if user %}{{ url_for('users.update', user_id=user.id) }}{% else %}{{ url_for('users.create') }}{% endif %}">
    <div class="form-grid">
        {# CAMPO EMAIL #}
        <div class="form-field {% if errors and errors.email %}has-error{% endif %}">
            <label for="email">Email *</label>
            <input type="email" id="email" name="email" 
                   value="{{ user.email if user else '' }}" required>
            {% if errors and errors.email %}
                <span class="error-message">{{ errors.email[0] }}</span>
            {% endif %}
        </div>
        
        {# CAMPO NOMBRE #}
        <div class="form-field {% if errors and errors.first_name %}has-error{% endif %}">
            <label for="first_name">Nombre *</label>
            <input type="text" id="first_name" name="first_name" 
                   value="{{ user.first_name if user else '' }}" required>
            {% if errors and errors.first_name %}
                <span class="error-message">{{ errors.first_name[0] }}</span>
            {% endif %}
        </div>
        
        {# CAMPO APELLIDO #}
        <div class="form-field {% if errors and errors.last_name %}has-error{% endif %}">
            <label for="last_name">Apellido *</label>
            <input type="text" id="last_name" name="last_name" 
                   value="{{ user.last_name if user else '' }}" required>
            {% if errors and errors.last_name %}
                <span class="error-message">{{ errors.last_name[0] }}</span>
            {% endif %}
        </div>
        
        {# CAMPO ROL DE USUARIO #}
        <div class="form-field {% if errors and errors.role %}has-error{% endif %}">
            <label for="role">Rol *</label>
            <select id="role" name="role" required>
                {% for role in roles %}
                    <option value="{{ role.value }}" 
                            {% if user and user.role == role.value %}selected{% endif %}>
                        {{ role_labels[role.value] }}
                    </option>
                {% endfor %}
            </select>
            {% if errors and errors.role %}
                <span class="error-message">{{ errors.role[0] }}</span>
            {% endif %}
        </div>
        
        {# checkbox USUARIO ACTIVO #}
        <div class="form-field checkbox-field">
            <label class="checkbox">
                <input type="checkbox" id="is_active" name="is_active" 
                       {% if not user or user.is_active %}checked{% endif %}>
                Usuario activo
            </label>
        </div>
        
        {# CAMPO CONTRASEÑA #}
        <div class="form-field {% if errors and errors.password %}has-error{% endif %}">
            <label for="password">
                Contraseña {% if not user %}*{% else %}(dejar en blanco para mantener la actual){% endif %}
            </label>
            <input type="password" id="password" name="password" 
                   {% if not user %}required{% endif %}>
            {% if errors and errors.password %}
                <span class="error-message">{{ errors.password[0] }}</span>
            {% endif %}
        </div>
    </div>

    {# botones #}
    <div class="form-actions">
        <button type="submit" class="primary-button">Guardar</button>
        <a href="{{ url_for('users.index') }}" class="secondary-button">Cancelar</a>
    </div>
</form>
{% endblock %}